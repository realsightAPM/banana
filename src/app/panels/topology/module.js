/*
  ## pies

  ### Parameters
  * style :: A hash of css styles
  * size :: top N
  * arrangement :: How should I arrange the query results? 'horizontal' or 'vertical'
  * chart :: Show a chart? 'none', 'bar', 'pie'
  * donut :: Only applies to 'pie' charts. Punches a hole in the chart for some reason
  * tilt :: Only 'pie' charts. Janky 3D effect. Looks terrible 90% of the time.
  * lables :: Only 'pie' charts. Labels on the pie?
*/
define([
  'angular',
  'app',
  'underscore',
  'jquery',
  'kbn',
  'echarts-liquidfill',
    'echarts-wordcloud'

],
function (angular, app, _, $, kbn) {
  'use strict';

  var module = angular.module('kibana.panels.network', []);
  app.useModule(module);

  module.controller('topology', function($scope, $http,$sce,$timeout, $translate,timer, querySrv, dashboard, filterSrv) {
    $scope.panelMeta = {
      exportfile: true,
      editorTabs : [
        {title:$translate.instant('Queries'), src:'app/partials/querySelect.html'}
      ],
      status  : "Stable",
      description : ""
    };

    // Set and populate defaults
    var _d = {
      panelExpand:true,
      fullHeight:'700%',
      useInitHeight:true,
      queries     : {
        mode        : 'all',
        ids         : [],
        query       : '*:*',
        custom      : ''
      },
      mode    : 'count', // mode to tell which number will be used to plot the chart.
      field   : '',
      stats_field : '',
      decimal_points : 0, // The number of digits after the decimal point
      exclude : [],
      missing : false,
      other   : false,
      size    : 10000,
      callerRange:1,
      calleeRange:1,
      options:false,
      sortBy  : 'count',
      order   : 'descending',
      fontsize   : 12,
      donut   : false,
      HbaseIP:'',
      isrefresh:true,
      tilt    : false,
      display:'block',
      edge:'',
      icon:"icon-caret-down",
      labels  : true,
	  ylabels :true,
      logAxis : false,
      arrangement : 'vertical',
	  RoseType	  : 'area',
      chart       : 'network',
        solrFq :filterSrv.getSolrFq(),
      exportSize : 10000,
        linkage_id:'a',
        value_sort:'rs_timestamp',
        defaulttimestamp:true,
      lastColor : '',
      spyable     : true,
      show_queries:true,
      error : '',
      chartColors : querySrv.colors,
      refresh: {
        enable: false,
        interval: 2
      }
    };
    _.defaults($scope.panel,_d);

    $scope.init = function () {
      // $('.fullscreen-link').on('click', function () {
      //   var ibox = $(this).closest('div.ibox1');
      //   var button = $(this).find('i');
      //
      //   $('body').toggleClass('fullscreen-ibox1-mode');
      //   button.toggleClass('fa-expand').toggleClass('fa-compress');
      //   ibox.toggleClass('fullscreen');
      //   $scope.panel.useInitHeight=!$scope.panel.useInitHeight;
      //   $scope.$emit('render');
      //
      //   $(window).trigger('resize');
      //
      // });
      $scope.hits = 0;
      //$scope.testMultivalued();
      $scope.options = false;
      // Start refresh timer if enabled
      if ($scope.panel.refresh.enable) {
        $scope.set_timer($scope.panel.refresh.interval);
      }

      $scope.$on('refresh',function(){
        $scope.get_data();
      });
      
      $scope.get_data();
    };
    $scope.reSize=function() {



      var ibox = $('#'+$scope.$id+'z').closest('div.ibox1');
      var button = $('#'+$scope.$id+'z').find('i');
      //var aaa = '#'+$scope.$id+'z';
      $('body').toggleClass('fullscreen-ibox1-mode');
      button.toggleClass('fa-expand').toggleClass('fa-compress');
      ibox.toggleClass('fullscreen');
      $scope.panel.fullHeight = ibox[0].offsetHeight-60;

        $scope.$emit('render');





    };

    //快捷键+控制放大缩小panel
    $scope.zoomOut=function() {
      if(window.event.keyCode===107){
        $scope.reSize();
      }


    };
    $scope.testMultivalued = function() {
      if($scope.panel.field && $scope.fields.typeList[$scope.panel.field] && $scope.fields.typeList[$scope.panel.field].schema.indexOf("M") > -1) {
        $scope.panel.error = "Can't proceed with Multivalued field";
        return;
      }

      if($scope.panel.stats_field && $scope.fields.typeList[$scope.panel.stats_field].schema.indexOf("M") > -1) {
        $scope.panel.error = "Can't proceed with Multivalued field";
        return;
      }
    };
    $scope.display=function() {
          if($scope.panel.display === 'none'){
              $scope.panel.display='block';
              $scope.panel.icon="icon-caret-down";


          }else{
              $scope.panel.display='none';
              $scope.panel.icon="icon-caret-up";
          }
      };
    /**
     *
     *
     * @param {String} filetype -'json', 'xml', 'csv'
     */
    $scope.build_query = function(filetype, isForExport) {

      // Build Solr query
      var fq = 'fl='+$scope.panel.field+' '+$scope.panel.edge+'&wt=json'+($scope.panel.queries.custom != null ? $scope.panel.queries.custom : '');


      //http://10.0.67.17:8080/getServerMapData.pinpoint?applicationName=DMDB&from=1499937049000&to=1499937349000&callerRange=1&calleeRange=1&serviceTypeName=TOMCAT&_=1499937383140
      //var surl = $sce.trustAsResourceUrl("http://10.0.67.14:28080/getServerMapData.pinpoint?applicationName=test123&from=1499838187000&to=1499838487000&callerRange=1&calleeRange=1&serviceTypeName=TOMCAT&_=1499838447935");
      // $.ajax({
      //   type: "get",
      //   async: false,
      //   url: "http://www.runoob.com/try/ajax/jsonp.php?jsoncallback=?",
      //   dataType: "jsonp",
      //   jsonp: "callback",
      //   jsonpCallback: "?",
      //   success: function(data){
      //    aaa = data;
      //
      //   },
      //   error: function(data){
      //     aaa = data.getAllResponseHeaders;
      //
      //   }
      // });
      // $.getJSON(surl, function(data) {
      //     aaa = data;
      // });
      // $http.jsonp("http://59.110.9.55:28080/getServerMapData.pinpoint?applicationName=dataviz2&from=1499761406000&to=1499934206000&callerRange=1&calleeRange=1&serviceTypeName=TOMCAT&_=1499915283292")
      //   .then(function successCallback(response){
      //     aaa = response;
      //   }, function errorCallback(response){
      //     aaa = response;
      //   });
      // window.JSON_CALLBACK = function(data) {
      //
      //  var aa =data;
      // };



      //var bbb = aaa;
      // if (filterSrv.getSolrFq()) {
      //   fq = '&' + filterSrv.getSolrFq();
      //     if(!$scope.panel.defaulttimestamp){
      //         fq = fq.replace(filterSrv.getTimeField(),$scope.panel.value_sort);
      //     }
      // }
      // var wt_json = '&wt=' + filetype;
      // var rows_limit = isForExport ? '&rows=0' : ''; // for pies, we do not need the actual response doc, so set rows=0
      // var facet = '';
      //
      // if ($scope.panel.mode === 'count') {
      //   facet = '&facet=true&facet.field=' + $scope.panel.field + '&facet.limit=' + $scope.panel.size + '&facet.missing=true';
      // } else {
      //   // if mode != 'count' then we need to use stats query
      //   // stats does not support something like facet.limit, so we have to sort and limit the results manually.
      //   facet = '&stats=true&stats.facet=' + $scope.panel.field + '&stats.field=' + $scope.panel.stats_field + '&facet.missing=true';
      // }
      // facet += '&f.' + $scope.panel.field + '.facet.sort=' + ($scope.panel.sortBy || 'count');
      //
      // var exclude_length = $scope.panel.exclude.length;
      // var exclude_filter = '';
      // if(exclude_length > 0){
      //   for (var i = 0; i < exclude_length; i++) {
      //     if($scope.panel.exclude[i] !== "") {
      //       exclude_filter += '&fq=-' + $scope.panel.field +":"+ $scope.panel.exclude[i];
      //     }
      //   }
      // }

      return  fq ;
    };

    $scope.exportfile = function(filetype) {

      var query = this.build_query(filetype, true);

      $scope.sjs.client.server(dashboard.current.solr.server + dashboard.current.solr.core_name);

      var request = $scope.sjs.Request().indices(dashboard.indices),
          response;

      request.setQuery(query);

      response = request.doSearch();

      // Populate scope when we have results
      response.then(function(response) {
        kbn.download_response(response, filetype, "pies");
      });
    };

    $scope.set_timer = function(refresh_interval) {
      $scope.panel.refresh.interval = refresh_interval;
      if (_.isNumber($scope.panel.refresh.interval)) {
        timer.cancel($scope.refresh_timer);
        $scope.realtime();
      } else {
        timer.cancel($scope.refresh_timer);
      }
    };

    $scope.realtime = function() {
      if ($scope.panel.refresh.enable) {
        timer.cancel($scope.refresh_timer);

        $scope.refresh_timer = timer.register($timeout(function() {
          $scope.realtime();
          $scope.get_data();
        }, $scope.panel.refresh.interval*1000));
      } else {
        timer.cancel($scope.refresh_timer);
      }
    };

    $scope.get_data = function() {

      //同id 图表刷新，图表自身点击不刷新，时间选择全局刷新，更换应用刷新
      if((($scope.panel.linkage_id === dashboard.current.linkage_id)&&dashboard.topology.network_force_refresh)||dashboard.current.enable_linkage) {
        // $scope.panelMeta.loading = true;
        $scope.query_url = "http://" + $scope.panel.HbaseIP + "/getServerMapData.pinpoint?applicationName="+dashboard.current.network_app_name+"&from=" + dashboard.current.timefrom + "&to=" + dashboard.current.timeto + "&callerRange="+$scope.panel.callerRange+"&calleeRange="+$scope.panel.calleeRange+"&serviceTypeName=TOMCAT";
        $.getJSON($scope.query_url, function (json) {
          $scope.data = json;
          dashboard.topology.hbasedata = json;


          $scope.$emit('render');
        });
      }


    };

    $scope.build_search = function(term,negate) {
            if (_.isUndefined(term.meta)) {
                filterSrv.set({
                    type: 'terms', field: $scope.panel.field, value: term.name,
                    mandate: (negate ? 'mustNot' : 'must')
                });
            } else if (term.meta === 'missing') {
                filterSrv.set({
                    type: 'exists', field: $scope.panel.field,
                    mandate: (negate ? 'must' : 'mustNot')
                });
            } else {
                return;
            }
            dashboard.current.linkage_id = $scope.panel.linkage_id;
            dashboard.current.enable_linkage = false;
            dashboard.refresh();

    };

    $scope.set_refresh = function (state) {
      $scope.refresh = state;
      // if 'count' mode is selected, set decimal_points to zero automatically.
      if ($scope.panel.mode === 'count') {
        $scope.panel.decimal_points = 0;
      }
    };

    $scope.confirm_refresh = function () {
      $scope.get_data();
      // if 'count' mode is selected, set decimal_points to zero automatically.
      $scope.$emit('render');
    };

    $scope.close_edit = function() {
      // Start refresh timer if enabled
      if ($scope.panel.refresh.enable) {
        $scope.set_timer($scope.panel.refresh.interval);
      }

      if ($scope.refresh) {
        // $scope.testMultivalued();
        $scope.get_data();
      }
      $scope.refresh =  false;
      $scope.$emit('render');
    };

    $scope.showMeta = function(term) {
      if(_.isUndefined(term.meta)) {
        return true;
      }
      if(term.meta === 'other' && !$scope.panel.other) {
        return false;
      }
      if(term.meta === 'missing' && !$scope.panel.missing) {
        return false;
      }
      return true;
    };

  });

  module.directive('topologyChart', function(querySrv,dashboard,filterSrv) {
    return {
      restrict: 'A',

      link: function(scope, elem) {
        var myChart;

        // Receive render events
        scope.$on('render',function(){
          render_panel();
        });

        // Re-render if the window is resized
        angular.element(window).bind('resize', function(){
          render_panel();
        });
        // Function for rendering panel
        function render_panel() {
          var colors = [];

          // IE doesn't work without this
          var divHeight=scope.panel.height||scope.row.height;
          if(!scope.panel.useInitHeight){
            divHeight = scope.panel.fullHeight;
          }
          elem.css({height:divHeight});

          // Make a clone we can operate on.


          if (filterSrv.idsByTypeAndField('pies',scope.panel.field).length > 0) {
            colors.push(scope.panel.lastColor);
          } else {
            colors = scope.panel.chartColors;
          }

          var idd = scope.$id;
          var labelcolor = false;
          if (dashboard.current.style === 'dark'||dashboard.current.style === 'black'){
              labelcolor = true;
          }
                // Add plot to scope so we can build out own legend
          var echarts = require('echarts');
         // require(['vis'], function(nw){
          if(myChart) {
            myChart.dispose();
          }
          if(scope.panel.chart === 'network') {
            var nodes = [];
            var edges = [];
            var dir = 'nodestyle/';
            var json = scope.data;
            // var svg = {
            //   "TOMCAT":'<svg width="256px" height="182px" viewBox="0 0 256 182" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid"> <g> <path d="M44.298,119.344 C47.21,122.936 50.447,126.576 54.01,130.236 C43.638,133.357 36.839,139.152 32.597,144.269 C25.887,152.368 22.335,163.064 23.152,172.244 L5.291,172.244 C8.873,164.471 23.171,142.015 44.298,119.344" fill="#D1A41A"></path> <path d="M251.194,177.115 L229.477,177.115 C179.657,151.118 135.918,132.786 89.453,128.781 C89.552,122.315 90.703,114.995 92.917,106.837 L88.637,105.686 C86.364,114.069 85.173,121.656 85.035,128.446 C80.194,128.121 75.323,127.964 70.403,127.964 C66.24,127.964 62.442,128.348 58.979,129.017 C54.462,124.51 50.615,120.2 47.348,116.117 C68.779,93.799 104.076,73.607 134.796,66.011 C143.446,94.763 162.014,114.463 184.547,127.718 C186.2,126.773 187.824,125.789 189.418,124.747 L228.729,167.068 L230.451,166.92 C241.186,165.996 247.287,171.821 248.902,173.631 C250.092,174.95 250.8,176.161 251.194,177.115" fill="#D1A41A"></path> <path d="M232.016,35.556 C232.813,74.611 212.887,105.696 184.99,121.637 C137.64,98.051 128.725,38.282 136.794,6.223 C139.037,18.484 143.121,26.169 151.938,29.938 C171.165,24.437 197.625,24.003 217.118,29.377 C225.236,23.473 228.385,14.45 230.107,6.568 C232.252,15.738 232.006,35.556 232.016,35.556" fill="#FFDC76"></path> <path d="M168.22,40.776 C169.857,40.776 171.005,41.441 171.835,42.863 C173.78,46.209 173.461,52.809 171.848,59.714 L158.752,59.714 L158.752,62.583 L171.111,62.583 C169.785,67.294 167.922,71.955 165.825,75.648 L165.147,76.842 L181.533,87.156 L172.308,93.235 L173.887,95.632 L184.198,88.834 L195.329,96.098 L196.858,93.67 L186.537,87.285 C186.537,87.285 201.968,77.262 202.735,76.772 C202.73,76.766 202.727,76.76 202.723,76.754 L202.741,76.751 C199.34,71.737 198.262,67.456 199.678,62.583 L200.836,62.583 L213.28,62.569 L213.309,59.714 L200.77,59.714 C203.08,54.278 206.314,49.384 217.858,49.384 L217.858,46.515 C207.207,46.515 200.832,50.744 197.779,59.714 L174.798,59.714 C176.405,52.543 176.684,45.494 174.312,41.419 C172.977,39.123 170.869,37.906 168.22,37.906 C158.727,37.906 154.979,47.607 154.825,48.02 L157.511,49.028 C157.645,48.677 160.74,40.776 168.22,40.776 L168.22,40.776 Z M184.164,85.422 L172.044,77.791 L195.73,77.797 L184.164,85.422 L184.164,85.422 Z M196.759,62.583 C195.74,65.831 196.149,70.724 198.657,74.923 L169.457,74.923 C171.233,71.364 172.88,67.026 174.084,62.583 L196.759,62.583 L196.759,62.583 Z" fill="#000000"></path> <path d="M157.512,49.028 L157.511,49.028 L157.51,49.03 L157.512,49.028" fill="#000000"></path> <path d="M252.205,170.602 C247.342,165.162 237.816,162.587 229.861,162.778 C224.79,156.742 197.884,128.337 192.452,122.609 C203.683,114.727 213.437,104.487 220.915,92.325 L235.762,92.325 L235.762,89.138 L222.794,89.138 C223.622,87.677 224.411,86.185 225.174,84.673 L235.762,84.673 L235.762,81.485 L226.716,81.485 C233.436,66.972 237.155,50.31 236.794,32.074 C236.807,32.082 236.82,32.088 236.832,32.095 C236.813,27.106 235.26,6.019 232.404,0.213 C224.66,3.156 210.569,12.69 207.38,22.44 C192.096,20.158 174.866,20.428 159.773,23.04 C157.251,12.55 144.595,4.522 135.047,0 C131.02,6.796 129.236,22.553 129.689,33.731 C129.672,33.742 129.654,33.754 129.636,33.766 C130.017,43.865 131.388,53.139 133.595,61.66 C100.575,69.842 64.626,91.473 44.517,112.378 C35.105,99.675 31.371,89.25 30.262,81.35 C28.861,71.373 31.243,62.22 37.149,54.881 C46.396,43.394 59.534,42.585 73.043,44.857 C72.779,46.99 73.059,49.029 73.914,50.291 C77.486,55.567 96.687,57.421 108.148,52.308 C99.69,40.456 82.558,34.669 77.811,36.988 C76.239,37.755 75.052,39.166 74.239,40.811 C69.57,39.976 64.933,39.354 61.543,39.379 C49.629,39.467 40.521,43.63 33.7,52.105 C27.007,60.42 24.302,70.746 25.877,81.966 C27.369,92.593 32.63,103.896 41.449,115.618 C39.984,117.189 38.568,118.741 37.205,120.265 C15.711,144.315 0,170.105 0,174.378 L0,176.592 L28.355,176.592 L27.858,173.967 C26.257,165.504 29.455,154.926 36.005,147.02 C40.117,142.057 46.927,136.392 57.621,133.778 C67.13,143.058 79.244,152.914 92.729,162.422 L113.8,162.422 L113.8,160.208 C113.8,157.71 112.562,155.523 110.312,154.051 C106.983,151.875 101.845,151.575 97.125,153.185 C92.625,148.173 90.102,141.478 89.557,133.163 C135.288,137.213 179.029,155.68 228.385,181.463 L255.541,181.463 L255.897,179.683 C256.404,177.149 255.023,173.754 252.205,170.602 L252.205,170.602 Z M136.793,6.15 C139.04,18.406 143.115,26.092 151.941,29.863 C159.755,27.627 168.77,26.243 178.022,25.732 L185.696,42.563 L190.616,25.586 C199.965,25.889 209.126,27.1 217.112,29.303 C225.235,23.397 228.385,14.376 230.105,6.494 C232.254,15.666 232.006,35.478 232.012,35.482 C232.163,42.88 231.568,49.99 230.318,56.767 L221.553,60.492 L229.277,61.662 C228.663,64.259 227.96,66.806 227.154,69.293 L219.68,71.463 L225.635,73.607 C224.617,76.305 223.497,78.936 222.263,81.485 L209.938,81.485 L209.938,84.673 L220.642,84.673 C219.834,86.192 218.984,87.678 218.102,89.138 L209.938,89.138 L209.938,92.325 L216.097,92.325 C207.994,104.596 197.264,114.547 184.987,121.563 C170.798,114.493 160.064,104.173 152.2,92.325 L156.905,92.325 L156.905,89.138 L150.173,89.138 C149.281,87.669 148.43,86.18 147.62,84.673 L156.905,84.673 L156.905,81.485 L145.975,81.485 C144.093,77.671 142.46,73.764 141.058,69.811 L146.627,68.252 L139.605,65.444 C138.895,63.153 138.258,60.853 137.693,58.552 L148.5,57.815 L136.142,51.258 C133.113,34.557 133.721,18.348 136.793,6.15 L136.793,6.15 Z M32.596,144.195 C25.889,152.29 22.334,162.983 23.148,172.164 L5.286,172.164 C8.875,164.397 23.171,141.944 44.295,119.264 C47.206,122.862 50.448,126.496 54.009,130.16 C43.638,133.278 36.838,139.075 32.596,144.195 L32.596,144.195 Z M229.471,177.035 C179.656,151.042 135.914,132.712 89.45,128.708 C89.551,122.242 90.703,114.923 92.911,106.766 L88.638,105.608 C86.367,113.993 85.171,121.585 85.036,128.371 C80.194,128.05 75.321,127.884 70.406,127.884 C66.237,127.884 62.44,128.271 58.977,128.944 C54.461,124.43 50.613,120.128 47.344,116.045 C53.159,109.987 60.001,104.09 67.488,98.556 L77.856,105.715 L74.471,93.625 C77.623,91.499 80.863,89.444 84.166,87.47 L99.531,95.278 L92.316,82.839 C94.419,81.703 96.539,80.603 98.67,79.543 L120.135,93.941 L113.086,73.053 C120.413,70.1 127.721,67.685 134.789,65.937 C136.45,71.449 138.482,76.62 140.829,81.485 L131.08,81.485 L131.08,84.673 L142.436,84.673 C143.235,86.192 144.061,87.683 144.924,89.138 L131.08,89.138 L131.08,92.325 L146.898,92.325 C156.599,107.383 169.707,118.913 184.543,127.64 C186.194,126.697 187.814,125.696 189.412,124.658 L193.3,128.844 L186.766,138.896 L197.911,133.808 L204.363,140.754 L193.456,149.065 L208.475,145.181 L228.732,166.989 L230.447,166.842 C241.185,165.923 247.288,171.746 248.904,173.553 C250.089,174.878 250.804,176.087 251.193,177.035 L229.471,177.035 L229.471,177.035 Z" fill="#000000"></path> </g> </svg>',
            //   "USER":'<svg t="1499914683515" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1836" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M483.67028 552.083927c0-1.520633-0.199545-2.994194-0.544399-4.41659-9.547447-70.487378-58.372455-129.384789-125.126812-156.497287 38.604226-24.954345 63.944358-66.852594 63.944358-114.364701 0-76.495208-65.765843-138.488121-146.82909-138.488121-81.065294 0-146.831136 61.993936-146.831136 138.488121 0 47.535643 25.365714 89.452311 64.001663 114.402563-66.118883 26.873044-114.615411 84.902692-124.798331 154.479327-0.729617 2.009773-1.144056 4.15667-1.144056 6.396687l0.106424 1.858324c0 10.891048 9.455349 19.763113 20.929682 19.763113 11.580756 0 20.930705-8.872065 20.930705-19.763113l-0.01535-0.26606 0.413416 0c9.767458-75.387991 75.745125-134.409223 157.105131-138.613988 3.076058 0.182149 6.175653 0.284479 9.30083 0.284479 3.127224 0 6.226818-0.103354 9.305947-0.284479 81.442894 4.202719 147.34586 63.224973 157.100014 138.613988l0.472767 0 0.030699 0.26606c0 10.891048 9.348925 19.763113 20.930705 19.763113 11.57871 0 20.928658-8.872065 20.928658-19.763113L483.67028 552.083927zM275.114336 375.824551c-58.011228 0-104.864326-44.303019-104.864326-98.965989 0-54.661947 46.853098-98.965989 104.864326-98.965989 57.902758 0 104.863303 44.304042 104.863303 98.965989C379.976616 331.521532 333.017094 375.824551 275.114336 375.824551z" p-id="1837"></path><path d="M962.364733 847.825558c-0.079818-0.868787-0.174985-1.732457-0.261966-2.600221l-0.005117-0.054235c0-2.599198-0.295735-5.122671-0.836041-7.546883-14.375405-117.386524-87.62878-215.470423-187.720406-260.642229 57.914014-41.60149 95.912443-111.451348 95.912443-190.625572 0-127.492696-98.594529-230.868111-220.243123-230.868111-121.595382 0-220.190935 103.375415-220.190935 230.868111 0 79.199807 38.022988 149.069107 95.955422 190.664457C425.827897 621.794615 353.045243 718.469422 337.733513 834.383408c-1.115404 3.37998-1.730411 7.006578-1.730411 10.787694l0.222057 2.537799c-0.00307 0.038886-0.008186 0.076748-0.011256 0.115634l0.021489 0 0.032746 0.37146c0 18.169825 14.077623 32.936133 31.448246 32.936133 17.317411 0 31.395034-14.766308 31.395034-32.936133l-0.038886-0.37146 0.576121 0c14.622022-125.722376 113.641223-224.114291 235.894591-231.003188 4.520967 0.290619 9.074679 0.455371 13.666254 0.455371 4.609994 0 9.18315-0.165776 13.722536-0.458441 122.274858 6.866385 221.320665 105.265462 235.944733 231.006258l0.656963 0 0.038886 0.37146c0 18.169825 14.024411 32.936133 31.395034 32.936133 17.371646 0 31.396057-14.766308 31.396057-32.936133l-0.032746-0.37146L962.364733 847.824535zM649.156288 551.352263c-86.854137 0-157.293419-73.838705-157.293419-164.890444 0-91.102904 70.439282-164.942633 157.293419-164.942633 86.908372 0 157.348678 73.839729 157.348678 164.942633C806.504966 477.513558 736.06466 551.352263 649.156288 551.352263z" p-id="1838"></path></svg>',
            //   "MYSQL":'<svg xmlns="http://www.w3.org/2000/svg" height="202pt" width="391pt" viewBox="0 0 391 202"><path d="M.738 183.825H13.58v-50.71l19.88 44.207c2.346 5.35 5.557 7.244 11.854 7.244 6.298 0 9.385-1.893 11.732-7.244l19.88-44.208v50.71h12.842v-50.627c0-4.94-1.976-7.327-6.05-8.56-9.755-3.047-16.3-.413-19.264 6.173l-19.51 43.63-18.892-43.63c-2.84-6.586-9.508-9.22-19.263-6.174-4.076 1.234-6.052 3.622-6.052 8.56v50.63zM100.442 142.556h12.838v27.938c-.12 1.518.487 5.08 7.522 5.19 3.59.057 27.7 0 27.925 0V142.42h12.868c.06 0-.013 45.364-.012 45.557.07 11.188-13.882 13.618-20.313 13.806h-40.55v-8.64c.072 0 40.52.01 40.622 0 8.265-.874 7.29-4.982 7.288-6.365v-3.368h-27.295c-12.7-.117-20.786-5.66-20.886-12.035-.01-.59.273-28.54-.008-28.82z" fill="#00618a"/><g fill="#e48e00"><path d="M171.5 183.83h36.92c4.322 0 8.52-.904 11.855-2.47 5.556-2.55 8.273-6.007 8.273-10.536v-9.384c0-3.705-3.087-7.163-9.138-9.467-3.21-1.236-7.162-1.894-10.99-1.894h-15.56c-5.184 0-7.654-1.565-8.27-5.022-.125-.412-.125-.742-.125-1.153v-5.844c0-.33 0-.66.124-1.07.616-2.634 1.975-3.376 6.543-3.787.37 0 .864-.083 1.235-.083h36.674v-8.56h-36.057c-5.186 0-7.903.33-10.372 1.07-7.656 2.387-10.99 6.174-10.99 12.76v7.49c0 5.764 6.545 10.703 17.534 11.855 1.236.082 2.47.164 3.704.164h13.337c.495 0 .99 0 1.36.082 4.074.33 5.802 1.07 7.038 2.552.74.74.987 1.482.987 2.305v7.49c0 .906-.617 2.06-1.85 3.046-1.113.988-2.965 1.647-5.435 1.812-.494 0-.864.082-1.358.082H171.5v8.56zM308.66 168.93c0 8.81 6.544 13.75 19.757 14.737 1.234.082 2.47.164 3.704.164h33.465v-8.56h-33.71c-7.533 0-10.373-1.894-10.373-6.42v-44.29H308.66v44.37zM236.74 169.38v-30.52c0-7.755 5.445-12.458 16.21-13.943a24.63 24.63 0 0 1 3.464-.247h24.376c1.237 0 2.352.083 3.59.247 10.764 1.485 16.208 6.188 16.208 13.942v30.52c0 6.292-2.312 9.66-7.64 11.853l12.65 11.418h-14.912l-10.234-9.237-10.303.653h-13.736c-2.35 0-4.825-.33-7.548-1.073-8.166-2.227-12.126-6.517-12.126-13.612zm13.86-.74c0 .412.124.824.248 1.32.742 3.546 4.083 5.526 9.156 5.526h11.667l-10.716-9.675h14.91l9.348 8.44c1.722-.92 2.856-2.323 3.252-4.126.123-.412.123-.825.123-1.237v-29.285c0-.33 0-.743-.123-1.156-.743-3.3-4.084-5.196-9.033-5.196h-19.426c-5.69 0-9.403 2.475-9.403 6.352v29.037z"/></g><path d="M376.88 110.357c-7.89-.22-13.93.52-19.08 2.69-1.47.62-3.8.63-4.04 2.47.81.84.93 2.1 1.57 3.14 1.23 2 3.31 4.66 5.16 6.06 2.03 1.53 4.12 3.17 6.29 4.49 3.86 2.36 8.17 3.7 11.89 6.06 2.2 1.39 4.38 3.15 6.51 4.72 1.06.77 1.77 1.98 3.15 2.47v-.23c-.73-.92-.91-2.18-1.58-3.14-.97-.97-1.94-1.95-2.91-2.92-2.86-3.79-6.48-7.11-10.33-9.87-3.07-2.21-9.94-5.19-11.22-8.76-.08-.07-.15-.15-.23-.22 2.18-.25 4.73-1.04 6.74-1.58 3.37-.9 6.39-.67 9.87-1.57 1.58-.45 3.15-.89 4.72-1.34v-.9c-1.76-1.81-3.02-4.2-4.94-5.84-5.03-4.28-10.51-8.55-16.16-12.12-3.13-1.976-7.01-3.26-10.33-4.937-1.11-.564-3.07-.857-3.81-1.796-1.75-2.224-2.7-5.042-4.04-7.632-2.82-5.426-5.587-11.35-8.083-17.06-1.703-3.892-2.815-7.73-4.938-11.223-10.193-16.758-21.164-26.872-38.16-36.814-3.615-2.114-7.97-2.95-12.57-4.04l-7.407-.45c-1.507-.63-3.075-2.473-4.49-3.366-5.63-3.556-20.07-11.293-24.24-1.122-2.633 6.42 3.935 12.685 6.284 15.937 1.65 2.283 3.76 4.84 4.938 7.408.775 1.686.91 3.378 1.572 5.163 1.632 4.396 3.05 9.18 5.162 13.243 1.066 2.055 2.242 4.22 3.59 6.06.828 1.127 2.245 1.624 2.47 3.367-1.387 1.94-1.466 4.95-2.245 7.407-3.508 11.06-2.185 24.81 2.918 32.993 1.566 2.52 5.254 7.91 10.325 5.84 4.436-1.81 3.445-7.41 4.714-12.346.287-1.12.11-1.942.673-2.692v.224c1.347 2.694 2.694 5.387 4.04 8.085 2.99 4.81 8.298 9.84 12.795 13.24 2.332 1.76 4.168 4.81 7.183 5.84v-.23h-.225c-.584-.91-1.498-1.29-2.244-2.02-1.757-1.72-3.71-3.86-5.163-5.83-4.09-5.56-7.704-11.64-10.997-17.962-1.573-3.02-2.94-6.354-4.266-9.428-.51-1.186-.505-2.978-1.57-3.592-1.452 2.253-3.59 4.074-4.714 6.734-1.796 4.25-2.028 9.437-2.693 14.817-.394.14-.22.04-.45.22-3.126-.75-4.225-3.97-5.386-6.732-2.94-6.982-3.485-18.226-.9-26.263.67-2.08 3.694-8.63 2.47-10.55-.584-1.917-2.512-3.025-3.59-4.49-1.336-1.81-2.67-4.194-3.593-6.285-2.404-5.444-3.527-11.556-6.06-17.058-1.21-2.632-3.256-5.295-4.937-7.633-1.86-2.59-3.945-4.5-5.387-7.633-.513-1.113-1.21-2.896-.45-4.04.243-.773.584-1.095 1.348-1.347 1.302-1.003 4.928.334 6.284.898 3.6 1.495 6.604 2.918 9.653 4.938 1.465.97 2.945 2.848 4.714 3.367h2.02c3.16.727 6.7.226 9.652 1.122 5.218 1.586 9.894 4.053 14.14 6.735 12.94 8.17 23.517 19.798 30.753 33.67 1.163 2.233 1.667 4.365 2.692 6.734 2.07 4.778 4.675 9.694 6.733 14.366 2.054 4.66 4.056 9.365 6.955 13.244 1.53 2.04 7.43 3.133 10.1 4.265 1.88.792 4.96 1.622 6.74 2.692 3.4 2.05 6.69 4.49 9.88 6.74 1.59 1.12 6.48 3.58 6.73 5.61z" fill="#00618a"/><path d="M276.54 24.833c-1.645-.03-2.81.18-4.04.45v.223h.225c.785 1.613 2.17 2.65 3.142 4.04a6815.3 6815.3 0 0 0 2.245 4.714l.224-.224c1.39-.98 2.027-2.546 2.02-4.938-.557-.586-.64-1.32-1.122-2.02-.642-.932-1.884-1.462-2.693-2.245z" fill="#00618a" fill-rule="evenodd"/><path d="M371.61 175.023c0 5.654 4.467 9.464 9.464 9.464s9.464-3.81 9.464-9.464c0-5.653-4.467-9.463-9.464-9.463s-9.464 3.81-9.464 9.463zm16.808 0c0 4.29-3.28 7.496-7.344 7.496-4.113 0-7.344-3.207-7.344-7.497s3.23-7.496 7.344-7.496c4.064 0 7.344 3.206 7.344 7.496zm-4.794 5.4h2.12l-3.104-4.743c1.665-.177 2.926-.985 2.926-2.953 0-2.196-1.387-3.104-4.062-3.104h-4.215v10.8h1.816v-4.668h1.69l2.828 4.67zm-4.518-6.182v-3.103h2.094c1.086 0 2.398.202 2.398 1.464 0 1.514-1.186 1.64-2.55 1.64h-1.942z" fill="#e48e00" fill-rule="evenodd"/></svg>',
            //   "MEMCACHED":'<svg width="254px" height="254px" viewBox="0 0 254 254" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <defs> <linearGradient x1="50.0000061%" y1="100%" x2="50.0000061%" y2="-3.50000005e-06%" id="linearGradient-1"> <stop stop-color="#574C4A" offset="0%"></stop> <stop stop-color="#80716D" offset="100%"></stop> </linearGradient> <linearGradient x1="88.778214%" y1="98.3421257%" x2="30.1494986%" y2="-8.67989994%" id="linearGradient-2"> <stop stop-color="#268D83" offset="0%"></stop> <stop stop-color="#2EA19E" offset="100%"></stop> </linearGradient> <radialGradient cx="41.4063333%" cy="42.7083333%" fx="41.4063333%" fy="42.7083333%" r="50%" id="radialGradient-3"> <stop stop-color="#DB7C7C" offset="0%"></stop> <stop stop-color="#C83737" offset="100%"></stop> </radialGradient> <radialGradient cx="44.2708333%" cy="42.7083333%" fx="44.2708333%" fy="42.7083333%" r="50%" id="radialGradient-4"> <stop stop-color="#DB7C7C" offset="0%"></stop> <stop stop-color="#C83737" offset="100%"></stop> </radialGradient> </defs> <g> <path d="M0,171.18976 L0,82.1710911 C0,10.2714062 10.2607175,2.63917525e-05 82.0863208,2.63917525e-05 L171.274821,2.63917525e-05 C243.10016,2.63917525e-05 253.360825,10.2714062 253.360825,82.1710911 L253.360825,171.18976 C253.360825,243.089471 243.10016,253.360851 171.274821,253.360851 L82.0863208,253.360851 C10.2607175,253.360851 0,243.089471 0,171.18976 L0,171.18976 Z" fill="url(#linearGradient-1)"></path> <g transform="translate(45.789223, 47.097648)"> <path d="M8.89120419,0.65492176 C-3.56241993,79.582765 2.95305984,153.479665 2.95305984,153.479665 L41.880895,153.479665 C38.1768996,133.776247 24.8889953,43.7562511 35.9427507,43.4590456 C41.8666989,44.3993442 68.9324415,119.83018 68.9324415,119.83018 C68.9324415,119.83018 74.8930954,119.087912 80.8912044,119.087912 C86.8893135,119.087912 92.8499674,119.83018 92.8499674,119.83018 C92.8499674,119.83018 119.915713,44.3993363 125.839658,43.4590456 C136.893437,43.75623 123.605496,133.776271 119.901514,153.479665 L158.829349,153.479665 C158.829349,153.479665 165.344826,79.5827413 152.891205,0.65492176 L116.849967,0.65492176 C109.98997,0.736057926 83.8902893,46.510592 80.8912044,46.510592 C77.8921196,46.510592 51.7924391,0.736057926 44.9324414,0.65492176 L8.89120419,0.65492176 L8.89120419,0.65492176 Z" fill="url(#linearGradient-2)"></path> <path d="M73.2135967,144.266563 C73.2135967,149.354829 69.0887422,153.479684 64.0004764,153.479684 C58.9122105,153.479684 54.787356,149.354829 54.787356,144.266563 C54.787356,139.178297 58.9122105,135.053443 64.0004764,135.053443 C69.0887422,135.053443 73.2135967,139.178297 73.2135967,144.266563 L73.2135967,144.266563 Z" fill="url(#radialGradient-3)"></path> <path d="M106.995038,144.266563 C106.995038,149.354829 102.870184,153.479684 97.7819178,153.479684 C92.6936519,153.479684 88.5687974,149.354829 88.5687974,144.266563 C88.5687974,139.178297 92.6936519,135.053443 97.7819178,135.053443 C102.870184,135.053443 106.995038,139.178297 106.995038,144.266563 L106.995038,144.266563 Z" fill="url(#radialGradient-4)"></path> <path d="M151.056318,3.26419253 C156.674191,41.2901292 157.992284,77.7849008 157.888889,104.969467 C157.783132,132.775271 156.190174,150.840489 156.190174,150.840489 L123.423113,150.840489 L119.901514,153.479665 L158.829349,153.479665 C158.829349,153.479665 165.344826,79.5827413 152.891205,0.65492176 L151.056318,3.26419253 Z M47.9015136,2.3044063 C58.1279219,13.6798033 75.8152734,43.8714168 78.2520292,43.8714168 C71.7678052,35.5785712 55.8405197,9.12270769 47.9015136,2.3044063 L47.9015136,2.3044063 Z M33.3035754,40.8198704 C22.2498279,41.1170864 35.5377376,131.137064 39.2417198,150.840489 L5.25962777,150.840489 L2.95305984,153.479665 L41.880895,153.479665 C38.1956695,133.876095 25.0246515,44.6553996 35.7778022,43.4590456 C34.7764595,41.9551776 33.9115992,40.9163797 33.3035754,40.8198704 L33.3035754,40.8198704 Z M123.200483,40.8198704 C117.276537,41.760161 90.2107921,117.191005 90.2107921,117.191005 C90.2107921,117.191005 84.2501382,116.448737 78.2520292,116.448737 C74.7030589,116.448737 71.6477332,116.667419 69.5816681,116.859946 L68.9324415,119.83018 C68.9324415,119.83018 74.8930954,119.087912 80.8912044,119.087912 C86.8893135,119.087912 92.8499674,119.83018 92.8499674,119.83018 C92.8499674,119.83018 119.711897,44.8941711 125.757184,43.4590456 C125.105764,41.8088881 124.300927,40.8494661 123.200483,40.8198704 L123.200483,40.8198704 Z" opacity="0.1" fill="#000000"></path> <path d="M8.89120419,0.65492176 C-3.56241993,79.582765 2.95305984,153.479665 2.95305984,153.479665 L5.24520996,150.903267 C4.07228657,133.468944 0.938595837,70.4220715 11.5303795,3.29409703 L47.5716167,3.29409703 C48.3351222,3.30307022 49.3589005,3.9286181 50.5406889,4.94358157 C48.1807489,2.31848894 46.218691,0.670133967 44.9324414,0.65492176 L8.89120419,0.65492176 Z M116.849967,0.65492176 C109.98997,0.736050008 83.8902893,46.510592 80.8912044,46.510592 C82.1142247,48.0747415 83.1074387,49.1497673 83.5303797,49.1497673 C86.5294646,49.1497673 112.629145,3.37517249 119.489143,3.29409703 L151.294812,3.29409703 L152.891205,0.65492176 L116.849967,0.65492176 Z M38.4169775,46.0982209 C47.171655,59.2464627 68.9324415,119.83018 68.9324415,119.83018 L69.5691795,116.875985 C64.1965312,102.143884 43.725214,46.9145996 38.5819259,46.0982209 C38.5259095,46.0997279 38.4717483,46.092127 38.4169775,46.0982209 L38.4169775,46.0982209 Z M128.478833,46.0982209 C134.351057,61.0754455 123.235098,135.74661 119.901514,153.479665 L123.432825,150.723373 C127.940463,124.276958 138.794686,46.375651 128.478833,46.0982209 L128.478833,46.0982209 Z" opacity="0.3" fill="#FFFFFF"></path> </g> </g> </svg>',
            //   "UNKNOWN":'<svg t="1499916039225" class="icon" style="" viewBox="0 0 1728 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2943" xmlns:xlink="http://www.w3.org/1999/xlink" width="337.5" height="200"><defs><style type="text/css"></style></defs><path d="M581.99961 32.405835c-264.859816 0-479.590276 214.730461-479.590276 479.590276s214.729164 479.590276 479.590276 479.590276 479.590276-214.729164 479.590277-479.590276-214.730461-479.590276-479.590277-479.590276z" fill="#F6E7A8" p-id="2944"></path><path d="M581.99961 1023.994815c-69.102545 0-136.156877-13.541537-199.298864-40.249971-60.971919-25.790626-115.724012-62.703825-162.73438-109.715489-47.011665-47.011665-83.924863-101.762461-109.714193-162.73438C83.54374 648.151692 70.002203 581.098656 70.002203 511.996111c0-69.102545 13.541537-136.156877 40.24997-199.298864 25.790626-60.971919 62.702529-115.724012 109.714193-162.73438 47.011665-47.011665 101.762461-83.924863 162.73438-109.714193 63.141987-26.708433 130.196319-40.24997 199.298864-40.24997s136.156877 13.541537 199.30016 40.24997c60.970622 25.790626 115.724012 62.702529 162.73438 109.714193 47.011665 47.010368 83.924863 101.762461 109.71549 162.73438 26.708433 63.141987 40.24997 130.196319 40.24997 199.298864 0 69.103841-13.541537 136.156877-40.24997 199.298864-25.790626 60.971919-62.703825 115.724012-109.71549 162.73438s-101.763758 83.924863-162.73438 109.715489c-63.14458 26.707137-130.197615 40.24997-199.30016 40.249971z m0-959.180553c-119.441907 0-231.737107 46.516464-316.201246 130.980603S134.817761 392.554204 134.817761 511.996111s46.516464 231.738403 130.980603 316.201246c84.464139 84.464139 196.75934 130.980603 316.201246 130.980603s231.738403-46.516464 316.201246-130.980603c84.464139-84.462843 130.980603-196.75934 130.980603-316.201246S982.664996 280.257708 898.200856 195.794865C813.738013 111.330725 701.441517 64.814262 581.99961 64.814262z" fill="#D0C300" p-id="2945"></path><path d="M586.648275 207.455417c51.276614 0 91.543436 14.111926 120.775837 42.30985 29.232401 28.210888 43.848602 68.466043 43.848602 120.775837 0 24.617441-5.902223 47.443345-17.692408 68.464747-11.803149 21.035662-30.002426 43.848602-54.619867 68.464747-14.880653 14.364711-26.670839 26.539909-35.386114 36.54115-8.725645 9.999944-15.264369 18.979671-19.617469 26.924921-4.362174 7.958213-7.186893 15.769941-8.461192 23.463702-1.285966 7.692464-1.922468 16.419406-1.922468 26.154897 0 32.827144-13.847473 49.233586-41.541122 49.233586-10.769969 0-19.231161-0.770024-25.386169-2.30748-6.153712-1.538752-10.902195-4.231244-14.231189-8.077476-3.341957-3.846232-5.517211-8.966764-6.538724-15.384929-1.034477-6.406498-1.538752-14.232485-1.538752-23.463701 0-52.311091 26.660469-104.620885 80.00474-156.931975 12.308721-11.791482 22.308665-21.6592 30.002425-29.617414 7.693761-7.94525 13.71395-15.386225 18.077421-22.308665 4.350507-6.923736 7.175226-13.847473 8.461192-20.769913 1.274299-6.923736 1.923764-15.252702 1.923764-25.001157 0-23.078689-6.923736-40.771098-20.769912-53.079818-13.847473-12.308721-33.07993-18.462433-57.696075-18.462433-24.617441 0-44.365841 7.055963-59.234827 21.154925-14.880653 14.111926-22.825903 31.156166-23.847417 51.156054-1.538752 30.266878-16.419406 45.387354-44.61733 45.387354-29.74964 0-44.61733-14.616201-44.61733-43.848602 0-42.045397 16.407739-79.487501 49.233586-112.314645 32.308609-32.308609 74.101221-48.463562 125.390798-48.463562z m-20.769913 481.56719c9.231216 0 17.812968 1.803205 25.771181 5.383688a71.085941 71.085941 0 0 1 21.153629 14.616201 71.091126 71.091126 0 0 1 14.616201 21.154925c3.581779 7.956917 5.384984 16.538669 5.384984 25.769885s-1.804501 17.814264-5.384984 25.771181a71.091126 71.091126 0 0 1-14.616201 21.154925 71.080755 71.080755 0 0 1-21.153629 14.614905c-7.958213 3.583076-16.539965 5.384984-25.771181 5.384984s-17.825931-1.803205-25.771181-5.384984a70.939454 70.939454 0 0 1-21.154925-14.614905 70.87723 70.87723 0 0 1-14.616201-21.154925c-3.593446-7.956917-5.384984-16.539965-5.384984-25.771181s1.790242-17.812968 5.384984-25.769885a70.900564 70.900564 0 0 1 14.616201-21.154925 70.943343 70.943343 0 0 1 21.154925-14.616201c7.94525-3.580483 16.538669-5.383688 25.771181-5.383688z" fill="#807800" p-id="2946"></path></svg>'
            // };

            //var svg = '<svg width="256px" height="182px" viewBox="0 0 256 182" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid"> <g> <path d="M44.298,119.344 C47.21,122.936 50.447,126.576 54.01,130.236 C43.638,133.357 36.839,139.152 32.597,144.269 C25.887,152.368 22.335,163.064 23.152,172.244 L5.291,172.244 C8.873,164.471 23.171,142.015 44.298,119.344" fill="#D1A41A"></path> <path d="M251.194,177.115 L229.477,177.115 C179.657,151.118 135.918,132.786 89.453,128.781 C89.552,122.315 90.703,114.995 92.917,106.837 L88.637,105.686 C86.364,114.069 85.173,121.656 85.035,128.446 C80.194,128.121 75.323,127.964 70.403,127.964 C66.24,127.964 62.442,128.348 58.979,129.017 C54.462,124.51 50.615,120.2 47.348,116.117 C68.779,93.799 104.076,73.607 134.796,66.011 C143.446,94.763 162.014,114.463 184.547,127.718 C186.2,126.773 187.824,125.789 189.418,124.747 L228.729,167.068 L230.451,166.92 C241.186,165.996 247.287,171.821 248.902,173.631 C250.092,174.95 250.8,176.161 251.194,177.115" fill="#D1A41A"></path> <path d="M232.016,35.556 C232.813,74.611 212.887,105.696 184.99,121.637 C137.64,98.051 128.725,38.282 136.794,6.223 C139.037,18.484 143.121,26.169 151.938,29.938 C171.165,24.437 197.625,24.003 217.118,29.377 C225.236,23.473 228.385,14.45 230.107,6.568 C232.252,15.738 232.006,35.556 232.016,35.556" fill="#FFDC76"></path> <path d="M168.22,40.776 C169.857,40.776 171.005,41.441 171.835,42.863 C173.78,46.209 173.461,52.809 171.848,59.714 L158.752,59.714 L158.752,62.583 L171.111,62.583 C169.785,67.294 167.922,71.955 165.825,75.648 L165.147,76.842 L181.533,87.156 L172.308,93.235 L173.887,95.632 L184.198,88.834 L195.329,96.098 L196.858,93.67 L186.537,87.285 C186.537,87.285 201.968,77.262 202.735,76.772 C202.73,76.766 202.727,76.76 202.723,76.754 L202.741,76.751 C199.34,71.737 198.262,67.456 199.678,62.583 L200.836,62.583 L213.28,62.569 L213.309,59.714 L200.77,59.714 C203.08,54.278 206.314,49.384 217.858,49.384 L217.858,46.515 C207.207,46.515 200.832,50.744 197.779,59.714 L174.798,59.714 C176.405,52.543 176.684,45.494 174.312,41.419 C172.977,39.123 170.869,37.906 168.22,37.906 C158.727,37.906 154.979,47.607 154.825,48.02 L157.511,49.028 C157.645,48.677 160.74,40.776 168.22,40.776 L168.22,40.776 Z M184.164,85.422 L172.044,77.791 L195.73,77.797 L184.164,85.422 L184.164,85.422 Z M196.759,62.583 C195.74,65.831 196.149,70.724 198.657,74.923 L169.457,74.923 C171.233,71.364 172.88,67.026 174.084,62.583 L196.759,62.583 L196.759,62.583 Z" fill="#000000"></path> <path d="M157.512,49.028 L157.511,49.028 L157.51,49.03 L157.512,49.028" fill="#000000"></path> <path d="M252.205,170.602 C247.342,165.162 237.816,162.587 229.861,162.778 C224.79,156.742 197.884,128.337 192.452,122.609 C203.683,114.727 213.437,104.487 220.915,92.325 L235.762,92.325 L235.762,89.138 L222.794,89.138 C223.622,87.677 224.411,86.185 225.174,84.673 L235.762,84.673 L235.762,81.485 L226.716,81.485 C233.436,66.972 237.155,50.31 236.794,32.074 C236.807,32.082 236.82,32.088 236.832,32.095 C236.813,27.106 235.26,6.019 232.404,0.213 C224.66,3.156 210.569,12.69 207.38,22.44 C192.096,20.158 174.866,20.428 159.773,23.04 C157.251,12.55 144.595,4.522 135.047,0 C131.02,6.796 129.236,22.553 129.689,33.731 C129.672,33.742 129.654,33.754 129.636,33.766 C130.017,43.865 131.388,53.139 133.595,61.66 C100.575,69.842 64.626,91.473 44.517,112.378 C35.105,99.675 31.371,89.25 30.262,81.35 C28.861,71.373 31.243,62.22 37.149,54.881 C46.396,43.394 59.534,42.585 73.043,44.857 C72.779,46.99 73.059,49.029 73.914,50.291 C77.486,55.567 96.687,57.421 108.148,52.308 C99.69,40.456 82.558,34.669 77.811,36.988 C76.239,37.755 75.052,39.166 74.239,40.811 C69.57,39.976 64.933,39.354 61.543,39.379 C49.629,39.467 40.521,43.63 33.7,52.105 C27.007,60.42 24.302,70.746 25.877,81.966 C27.369,92.593 32.63,103.896 41.449,115.618 C39.984,117.189 38.568,118.741 37.205,120.265 C15.711,144.315 0,170.105 0,174.378 L0,176.592 L28.355,176.592 L27.858,173.967 C26.257,165.504 29.455,154.926 36.005,147.02 C40.117,142.057 46.927,136.392 57.621,133.778 C67.13,143.058 79.244,152.914 92.729,162.422 L113.8,162.422 L113.8,160.208 C113.8,157.71 112.562,155.523 110.312,154.051 C106.983,151.875 101.845,151.575 97.125,153.185 C92.625,148.173 90.102,141.478 89.557,133.163 C135.288,137.213 179.029,155.68 228.385,181.463 L255.541,181.463 L255.897,179.683 C256.404,177.149 255.023,173.754 252.205,170.602 L252.205,170.602 Z M136.793,6.15 C139.04,18.406 143.115,26.092 151.941,29.863 C159.755,27.627 168.77,26.243 178.022,25.732 L185.696,42.563 L190.616,25.586 C199.965,25.889 209.126,27.1 217.112,29.303 C225.235,23.397 228.385,14.376 230.105,6.494 C232.254,15.666 232.006,35.478 232.012,35.482 C232.163,42.88 231.568,49.99 230.318,56.767 L221.553,60.492 L229.277,61.662 C228.663,64.259 227.96,66.806 227.154,69.293 L219.68,71.463 L225.635,73.607 C224.617,76.305 223.497,78.936 222.263,81.485 L209.938,81.485 L209.938,84.673 L220.642,84.673 C219.834,86.192 218.984,87.678 218.102,89.138 L209.938,89.138 L209.938,92.325 L216.097,92.325 C207.994,104.596 197.264,114.547 184.987,121.563 C170.798,114.493 160.064,104.173 152.2,92.325 L156.905,92.325 L156.905,89.138 L150.173,89.138 C149.281,87.669 148.43,86.18 147.62,84.673 L156.905,84.673 L156.905,81.485 L145.975,81.485 C144.093,77.671 142.46,73.764 141.058,69.811 L146.627,68.252 L139.605,65.444 C138.895,63.153 138.258,60.853 137.693,58.552 L148.5,57.815 L136.142,51.258 C133.113,34.557 133.721,18.348 136.793,6.15 L136.793,6.15 Z M32.596,144.195 C25.889,152.29 22.334,162.983 23.148,172.164 L5.286,172.164 C8.875,164.397 23.171,141.944 44.295,119.264 C47.206,122.862 50.448,126.496 54.009,130.16 C43.638,133.278 36.838,139.075 32.596,144.195 L32.596,144.195 Z M229.471,177.035 C179.656,151.042 135.914,132.712 89.45,128.708 C89.551,122.242 90.703,114.923 92.911,106.766 L88.638,105.608 C86.367,113.993 85.171,121.585 85.036,128.371 C80.194,128.05 75.321,127.884 70.406,127.884 C66.237,127.884 62.44,128.271 58.977,128.944 C54.461,124.43 50.613,120.128 47.344,116.045 C53.159,109.987 60.001,104.09 67.488,98.556 L77.856,105.715 L74.471,93.625 C77.623,91.499 80.863,89.444 84.166,87.47 L99.531,95.278 L92.316,82.839 C94.419,81.703 96.539,80.603 98.67,79.543 L120.135,93.941 L113.086,73.053 C120.413,70.1 127.721,67.685 134.789,65.937 C136.45,71.449 138.482,76.62 140.829,81.485 L131.08,81.485 L131.08,84.673 L142.436,84.673 C143.235,86.192 144.061,87.683 144.924,89.138 L131.08,89.138 L131.08,92.325 L146.898,92.325 C156.599,107.383 169.707,118.913 184.543,127.64 C186.194,126.697 187.814,125.696 189.412,124.658 L193.3,128.844 L186.766,138.896 L197.911,133.808 L204.363,140.754 L193.456,149.065 L208.475,145.181 L228.732,166.989 L230.447,166.842 C241.185,165.923 247.288,171.746 248.904,173.553 C250.089,174.878 250.804,176.087 251.193,177.035 L229.471,177.035 L229.471,177.035 Z" fill="#000000"></path> </g> </svg>';

           // $.getJSON("vendor/echarts/test.json", function (json) {
              for (var i1 = 0;i1<json.applicationMapData.nodeDataArray.length;i1++){
                if(json.applicationMapData.nodeDataArray[i1].histogram.Error>0){
                  nodes.push({id:json.applicationMapData.nodeDataArray[i1].key, label: json.applicationMapData.nodeDataArray[i1].applicationName, image: dir + json.applicationMapData.nodeDataArray[i1].category+'_ERROR.png', shape: 'image'});
                }else{
                  nodes.push({id:json.applicationMapData.nodeDataArray[i1].key, label: json.applicationMapData.nodeDataArray[i1].applicationName, image: dir + json.applicationMapData.nodeDataArray[i1].category+'.png', shape: 'image'});
                }
               // var url = "data:image/svg+xml;charset=utf-8,"+ encodeURIComponent(svg[json.applicationMapData.nodeDataArray[i1].category]);

              }
              for (var i2 = 0;i2<json.applicationMapData.linkDataArray.length;i2++){

                edges.push({from: json.applicationMapData.linkDataArray[i2].from, arrows:'to', to: json.applicationMapData.linkDataArray[i2].to, length: 300,label:json.applicationMapData.linkDataArray[i2].totalCount});

              }

            // create some edges


            // create a network
              var layoutMethod = "directed";
            var data = {
              nodes: nodes,
              edges: edges
            };
              var options = {
                layout: {
                  hierarchical: {
                    enabled:false,
                    sortMethod: layoutMethod,
                    direction:'LR',
                    nodeSpacing:500,
                    treeSpacing:600,
                    levelSeparation:300
                  }
                },
                nodes: {
                  font: {
                    size: scope.panel.fontsize,
                    color: labelcolor?'#DCDCDC':'#696969'
                  }

                },
                edges: {
                  font: {
                    size: scope.panel.fontsize,
                    color: labelcolor?'#DCDCDC':'#696969'
                  }

                },
              };





            var network = new vis.Network(document.getElementById(idd), data, options);
            network.on('click', function (params) {
              if(params.nodes.length>0){
                dashboard.current.network_node_id = params.nodes[0];
                dashboard.current.linkage_id = scope.panel.linkage_id;
                dashboard.current.enable_linkage = false;
                dashboard.current.topology_click=true;
                dashboard.current.network_bar_show =true;
                scope.panel.isrefresh = false;
                dashboard.topology.network_force_refresh = false;
                dashboard.refresh();
              }

            });
                     // var bb = network.getSelection();
            // var cc= bb;
           // });
          }


       // });
        }
      }
    };
  });

});
